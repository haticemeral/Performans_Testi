{% extends "layout.html" %}
{% block content %}

<div class="text-center mb-5">
    <h1 class="display-5 fw-bold">â¤ï¸ Favori Konserlerim</h1>
    <p class="lead text-muted">BeÄŸendiÄŸin etkinlikleri buradan takip et</p>
</div>

<div class="row" id="favList">
    <div class="col-12 text-center">
        <div class="spinner-border text-danger" role="status">
            <span class="visually-hidden">YÃ¼kleniyor...</span>
        </div>
    </div>
</div>

<script>
    const posters = {
        "Duman": "/static/images/duman.jpg",
        "Adamlar": "/static/images/adamlar.jpg",
        "YÃ¼zyÃ¼zeyken KonuÅŸuruz": "/static/images/yyk.jpg",
        "Manifest": "/static/images/manifest.jpg",
        "DedublÃ¼man": "/static/images/dedubluman.jpg",
        "GÃ¶ksel": "/static/images/goksel.jpg"
    };

    fetch('/api/favorites')
        .then(r => r.json())
        .then(data => {
            if (data.error) {
                document.getElementById("favList").innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-warning">
                            <h5>âš ï¸ ${data.error}</h5>
                            <a href="/login" class="btn btn-primary mt-2">GiriÅŸ Yap</a>
                        </div>
                    </div>
                `;
                return;
            }

            if (data.length === 0) {
                document.getElementById("favList").innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info">
                            <h5>ğŸ’” HenÃ¼z favori eklemedin</h5>
                            <p>BeÄŸendiÄŸin konserleri favorilere ekleyerek buradan takip edebilirsin!</p>
                            <a href="/" class="btn btn-primary mt-2">Konserlere GÃ¶z At</a>
                        </div>
                    </div>
                `;
                return;
            }

            let html = "";
            data.forEach(e => {
                let img = posters[e.name] || "/static/images/dedubluman.jpg";
                html += `
                <div class="col-md-4 mb-4">
                    <div class="concert-card">
                        <img src="${img}" class="poster" alt="${e.name}">
                        <div class="p-3">
                            <h4 class="fw-bold">${e.name}</h4>
                            <p class="text-muted mb-2">ğŸ“ ${e.location}</p>
                            <p class="text-muted mb-3">ğŸ“… ${e.date}</p>
                            <p class="fw-semibold mb-3">ğŸ« Kalan: ${e.stock} bilet</p>
                            <a href="/event/${e.id}" class="btn btn-primary w-100">Bilet Al</a>
                        </div>
                    </div>
                </div>`;
            });
            document.getElementById("favList").innerHTML = html;
        })
        .catch(err => {
            console.error(err);
            document.getElementById("favList").innerHTML = `
                <div class="col-12 text-center">
                    <div class="alert alert-danger">Bir hata oluÅŸtu!</div>
                </div>
            `;
        });
</script>

{% endblock %}